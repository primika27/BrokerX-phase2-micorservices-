@startuml uc03_depot_fonds_gateway_jwt
title UC03 - Dépôt de fonds via Gateway (JWT & Microservices)

actor Client
participant "Gateway" as Gateway
participant "AuthService" as AuthService
participant "WalletService" as WalletService
database "WalletDB"

Client -> Gateway : POST /api/wallet/deposit (Authorization: Bearer JWT)
Gateway -> AuthService : Decode JWT → extract email
AuthService --> Gateway : userEmail

Gateway -> WalletService : POST /deposit (X-Authenticated-User: userEmail, amount)

alt amount <= 0
    WalletService --> Gateway : 400 Bad Request
    Gateway --> Client :Deposit amount must be positive
else amount > 0
    WalletService -> WalletDB : findByOwnerEmail(userEmail)
    alt Wallet exists
        WalletDB --> WalletService : Wallet
    else Wallet doesn't exist
        WalletService -> WalletDB : create new Wallet(userEmail)
        WalletDB --> WalletService : New wallet
    end

    WalletService -> WalletDB : update balance += amount
    WalletDB --> WalletService : Updated wallet

    WalletService --> Gateway : 200 OK
    Gateway --> Client : Deposit of {amount}$ successful
end
@enduml
